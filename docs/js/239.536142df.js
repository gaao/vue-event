"use strict";(self["webpackChunkvue_event"]=self["webpackChunkvue_event"]||[]).push([[239],{7239:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("文章列表")])]),t("div",[t("div",{staticClass:"container-top"},[t("el-form",{attrs:{inline:!0,model:e.queryInfo}},[t("el-form-item",{attrs:{label:"文章分类"}},[t("el-select",{attrs:{placeholder:"请选择分类"},model:{value:e.queryInfo.cate_id,callback:function(t){e.$set(e.queryInfo,"cate_id",t)},expression:"queryInfo.cate_id"}},e._l(e.cateOption,(function(e){return t("el-option",{key:e.id,attrs:{label:e.cate_name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"发布状态"}},[t("el-select",{attrs:{placeholder:"请选择状态"},model:{value:e.queryInfo.state,callback:function(t){e.$set(e.queryInfo,"state",t)},expression:"queryInfo.state"}},[t("el-option",{attrs:{label:"已发布",value:"已发布"}}),t("el-option",{attrs:{label:"草稿",value:"草稿"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.searchFn}},[e._v("查询")])],1)],1),t("el-button",{staticClass:"btn-add",attrs:{icon:"el-icon-plus"},on:{click:function(t){return e.oprnDialogArticle("发表")}}},[e._v("发布文章")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.articleList,border:""},on:{"row-click":e.rowClick}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60px"}}),t("el-table-column",{attrs:{prop:"title",label:"标题"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{on:{click:function(t){return e.oprnDialogArticle("查看",a.row.cate_id)}}},[e._v(e._s(a.row.title))])]}}])}),t("el-table-column",{attrs:{prop:"cate_name",label:"分类"}}),t("el-table-column",{attrs:{prop:"pub_date",label:"发布时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.$formatDate(a.row.pub_date)))])]}}])}),t("el-table-column",{attrs:{prop:"state",label:"状态"}}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.oprnDialogArticle("查看",a.row.id)}}},[e._v("查看")]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.delArticle(a.row.id)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.queryInfo.pagenum,"page-sizes":[2,5,10,50],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),t("el-dialog",{attrs:{title:e.dialogTitle+"文章",visible:e.addArticeVisible,fullscreen:""},on:{close:e.dialogCloseFn}},["发表"===e.dialogTitle?t("el-form",{ref:"addArticleRef",attrs:{model:e.articleInfo,"label-width":"100px",rules:e.addArticleRules}},[t("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入文章标题"},model:{value:e.articleInfo.title,callback:function(t){e.$set(e.articleInfo,"title",t)},expression:"articleInfo.title"}})],1),t("el-form-item",{attrs:{label:"文章分类",prop:"cate_id"}},[t("el-select",{attrs:{placeholder:"请输入文章分类"},model:{value:e.articleInfo.cate_id,callback:function(t){e.$set(e.articleInfo,"cate_id",t)},expression:"articleInfo.cate_id"}},e._l(e.cateOption,(function(e){return t("el-option",{key:e.id,attrs:{label:e.cate_name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"文章内容",prop:"content"}},[t("quill-editor",{staticClass:"hanhua",on:{blur:e.contentChangeFn},model:{value:e.articleInfo.content,callback:function(t){e.$set(e.articleInfo,"content",t)},expression:"articleInfo.content"}})],1),t("el-form-item",{attrs:{label:"文章封面",prop:"cover_img"}},[t("div",[e.articleInfo.cover_img?t("img",{attrs:{src:e.coverImgSrc,alt:"这里是个图"}}):e._e(),t("div",{staticClass:"img-box"},[t("input",{ref:"coverRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:e.onFideChange}}),t("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:e.chooseImg}},[e._v("选择封面")])],1)])])],1):t("div",{staticClass:"details"},[t("h1",{staticClass:"details-title"},[e._v(e._s(e.articleInfoDetails.title))]),t("div",{staticClass:"details-info"},[t("div",[t("span",[e._v("作者：")]),t("p",[e._v(e._s(e.articleInfoDetails.nickname||e.articleInfoDetails.username))])]),t("div",[t("span",[e._v("发表时间：")]),t("p",[e._v(e._s(e.$formatDate(e.articleInfoDetails.pub_date)))])]),t("div",[t("span",[e._v("所属分类：")]),t("p",[e._v(e._s(e.articleInfoDetails.cate_name))])])]),t("div",{staticClass:"details-container"},[t("span",[e._v("封面图：")]),t("div",[e.articleInfoDetails.cover_img?t("img",{attrs:{src:e.baseURL+e.articleInfoDetails.cover_img}}):e._e()])]),t("div",{staticClass:"details-container"},[t("span",[e._v("内容：")]),t("div",{domProps:{innerHTML:e._s(e.articleInfoDetails.content)}})])]),"发表"===e.dialogTitle?t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.addArticeFn("草稿")}}},[e._v("存草稿")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addArticeFn("已发布")}}},[e._v("点击发布")])],1):t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addArticeVisible=!1}}},[e._v("确定")])],1)],1)],1)},l=[],s=a(7877),r=a(6361),o={data(){return{cateOption:[],queryInfo:{pagenum:1,pagesize:2,cate_id:"",state:""},articleList:[],total:0,addArticeVisible:!1,dialogTitle:"",articleInfo:{title:"",cate_id:"",content:"",cover_img:"",state:""},articleInfoDetails:{},coverImgSrc:"",addArticleRules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:30,message:"1-30 个任意字符",trigger:"blur"}],cate_id:[{required:!0,message:"请选择文章分类",trigger:"change"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}],cover_img:[{required:!0,message:"请输入文章封面",trigger:"change"}],state:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},baseURL:r.v}},created(){this.getCateList(),this.getArticleList()},methods:{async getCateList(){const{data:e}=await(0,s.F_)();this.cateOption=e.data,console.log("this.cateIds",this.cateOption)},rowClick(){console.log(222)},async searchFn(){const e=await(0,s.Us)(this.queryInfo);if(console.log("res",e),0!==e.data.code)return this.$message.error(e.data.message);this.$message.success(e.data.message),console.log("res.data.data",e.data.data),this.articleList=e.data.data,this.total=e.data.total},async getArticleList(){const e=await(0,s.Us)(this.queryInfo);if(0!==e.data.code)return this.$message.error(e.data.message);console.log("res.data",e.data),this.articleList=e.data.data,this.total=e.data.total},async oprnDialogArticle(e,t){if(this.addArticeVisible=!0,this.dialogTitle=e,"发表"===e)console.log("fabiao");else if("查看"===e){const e=await(0,s.Jc)(t);if(console.log("res",e),0!==e.data.code)return this.$message.error(e.data.message);this.articleInfoDetails=e.data.data}},chooseImg(){console.log(232323),this.$refs.coverRef.click()},onFideChange(e){const t=e.target.files;if(0===t.length)this.articleInfo.cover_img=null;else{this.articleInfo.cover_img=t[0];const e=URL.createObjectURL(t[0]);this.coverImgSrc=e}this.$refs.addArticleRef.validateField("cover_img"),console.log("5555",t[0]),console.log("5555",e.target.value)},contentChangeFn(){this.$refs.addArticleRef.validateField("content")},dialogCloseFn(){this.$refs.addArticleRef.resetFields(),this.addArticeVisible=!1},addArticeFn(e){this.articleInfo.state=e,console.log("this.articleInfo",this.articleInfo),this.$refs.addArticleRef.validate((async e=>{if(!e)return!1;{const e=new FormData;e.append("title",this.articleInfo.title),e.append("cate_id",this.articleInfo.cate_id),e.append("content",this.articleInfo.content),e.append("cover_img",this.articleInfo.cover_img),e.append("state",this.articleInfo.state);const{data:t}=await(0,s.j)(e);if(console.log("res",t),0!==t.code)return this.$message.error(t.message);this.$message.success(t.message),this.addArticeVisible=!1,this.getArticleList()}}))},async delArticle(e){const{data:t}=await(0,s.VT)(e);if(console.log("res",t),0!==t.code)return this.$message.error(t.message);this.$message.success(t.message),1===this.articleList.length&&this.queryInfo.pagenum>1&&this.queryInfo.pagenum--,this.getArticleList()},handleSizeChange(e){console.log(`每页 ${e} 条`),this.queryInfo.pagesize=e,this.getArticleList()},handleCurrentChange(e){console.log(`当前页：${e}`),this.queryInfo.pagenum=e,this.getArticleList()}}},n=o,c=a(1001),d=(0,c.Z)(n,i,l,!1,null,"b902a628",null),u=d.exports}}]);
//# sourceMappingURL=239.536142df.js.map